services:
  - type: web
    name: defunds-finance
    env: node
    plan: free
    buildCommand: npm install && npm run build
    startCommand: npm start
    healthCheckPath: /
    envVars:
      - key: NODE_ENV
        value: production
    domains:
      - defunds.finance
      - www.defunds.finance

  - type: web
    name: defunds-backend
    env: node
    plan: free
    buildCommand: npm install && npm -w apps/backend run build
    startCommand: node apps/backend/dist/index.js
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 10000
      # You must add these in Render dashboard or here securely
      # - key: MONGODB_URI
      #   sync: false
      # - key: SOLANA_RPC_URL
      #   sync: false
    routes:
      - type: tcp
        port: 10000

  - type: cron
    name: defunds-points-cron
    env: node
    schedule: "0 * * * *" # every hour at minute 0 (UTC)
    region: oregon
    buildCommand: npm install && npm -w apps/backend run build
    startCommand: node apps/backend/dist/scripts/runHourlyPoints.js
    envVars:
      - key: NODE_ENV
        value: production
      # Required in env: MONGODB_URI
      # Optional: SOLANA_RPC_URL

  - type: cron
    name: defunds-pnl-daily-cron
    env: node
    # Run once daily at 01:00 UTC
    schedule: "0 1 * * *"
    region: oregon
    buildCommand: npm install && npm -w apps/backend run build
    startCommand: node apps/backend/dist/scripts/runDailyPnl.js
    envVars:
      - key: NODE_ENV
        value: production
      # Required in env: MONGODB_URI
      # Optional: SOLANA_RPC_URL, MANAGED_FUNDS_PROGRAM_ID, PRICES_BASE_URL or WEB_BASE_URL
